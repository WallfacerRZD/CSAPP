## 局部性
局部性原理: 一个编写良好的程序常常具有良好的局部性,它们倾向于引用临近于其他最近引用过的数据项的数据项.或者最近引用过的数据项本身.   

#### 量化评价程序中局部性的简单原则
1. 重复引用相同变量的程序具有良好的局部性
2. 对于具有步长为k的引用模式的程序,  步长越小, 空间局部性越好.
3. 对于取指令来说, 循环有好的时间和空间局部性.循环体越小, 循环迭代次数越好, 局部性越好

## 存储器层次结构

对于每个k, 位于k层的更快更小的存储设备作为位于k+1层的更大更慢的存储设备的缓存.k+1层存储器被划分成连续的数据对象组块,称为块

![图片](https://github.com/WallfacerRZD/CSAPP/chapter6/0.png)  

#### 缓存命中
程序需要第k+1层的某个数据对象d时, 它首先在第k层的一个块中查找d,如果d刚好缓存在第k层中,那么就叫缓存命中.

#### 缓存不命中
如果第k层没有缓存数据对象d, 那么就是缓存不命中.当缓存不命中发生时,若k层已满,从k+1层取出的数据对象d会覆盖现存的一个块.

#### 存储器层次结构概念小结
- 利用时间局部性:由于时间局部性, 同一数据对象可能被多次使用, 一旦一个数据对象在第一次不命中时被复制到缓存中, 我们就期望后面对该目标有一系类的访问命中.

- 利用空间局部性:快通常包含有多个数据对象.由于空间局部性, 我们会期望后面对该块中其他对象的访问能够补偿不命中后复制该块的花费.

#### 编写高速缓存友好的代码
1. 让最常见的情况运行得快
2. 尽量减小每个循环内部的缓存不命中数量


#### 在程序中利用局部性
1. 将注意力集中在内循环上, 大部分的计算和内存访问都在这里
2. 通过按照数据对象存储在内存中的顺序, 以步长为1的来读数据, 从而使得你的程序中的空间局部性最大
3. 一旦从存储器中读入了一个数据对象, 就尽可能多地使用它, 从而使得程序中的时间局部性最大.

***
2018/1/21
家


